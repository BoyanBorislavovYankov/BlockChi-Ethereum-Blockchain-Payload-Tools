<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Blockchain Payload Tools</title>
  <meta name="author" content="Boyan Yankov">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="dist/bpteth.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="row">
      <h1>Blockchain Payload Tools Demo</h1>
    </div>
    
    <div class="row">  
      <h2>Get transaction payload</h2>
      <table class="table">
        <tr>  
          <th scope="row">Transaction hash <br />(put your Ethereum transaction hash here or test the example)</th>
          <td><input type="text" name="transaction_hash" id="transaction_hash" value="0x512e6d93aeb2d8a3884270b37f574e4bdd2c2f29d86af335aee0a7c469b281e7" /></td>
        </tr>
        <tr>  
          <th scope="row">Transaction data, raw (JSON / text)</th>
          <td id="transaction_data"></td>
        </tr>
        <tr>  
          <th scope="row">Transaction data, decoded</th>
          <td id="transaction_data_decoded"></td>
        </tr>
        <tr>  
          <td colspan="2"><input type="submit" id="transaction_payload_button" value="Get data" /></td>
        </tr>
      </table>
    </div>
    <script>
      document.getElementById('transaction_payload_button').addEventListener("click", function(event){
        event.preventDefault()
        
        //put your Ethereum HTTP API url here or test the example
        let apiUrl = "https://ropsten.infura.io/";
        
        //get form data
        let transactionHash = document.getElementById('transaction_hash').value;
        
        const bptEth = new BptEth(apiUrl);
        
        let transactionPayload = bptEth.getTransactionPayload(transactionHash);
        
        console.log(transactionPayload);
        
        document.getElementById('transaction_data').innerHTML = escapeHtmlEntities(transactionPayload.payloadAscii);        

        let transactionPayloadObject = bptEth.textToJson(transactionPayload.payloadAscii);
        
        console.log(transactionPayloadObject);
        
        document.getElementById('transaction_data_decoded').innerHTML += '<strong>Description:</strong> '+transactionPayloadObject.result.description+'<br />';
        document.getElementById('transaction_data_decoded').innerHTML += '<strong>Item:</strong> '+transactionPayloadObject.result.items[0].type+'<br />';
        document.getElementById('transaction_data_decoded').innerHTML += transactionPayloadObject.result.items[0].title+'<br />';
        document.getElementById('transaction_data_decoded').innerHTML += transactionPayloadObject.result.items[0].dataText+'<br />';        
      });
      
      function escapeHtmlEntities(rawStr){
        let encodedStr = rawStr.replace(/[\u00A0-\u9999<>\&]/gim, function(i) {
           return '&#'+i.charCodeAt(0)+';';
        });
        
        return encodedStr;
      }
    </script>
    
  </div>
</body>
</html>