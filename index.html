<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Blockchain Payload Tools</title>
  <meta name="author" content="Boyan Yankov">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="dist/bpteth.min.js"></script>
</head>
<body>
  <div class="container">
    <div class="row">
      <h1>Blockchain Payload Tools Demo</h1>
      <table class="table">
        <tr>  
          <th scope="row">Transaction hash</th>
          <td id="transaction_hash">Loading...</td>
        </tr>
        <tr>  
          <th scope="row">Transaction data, text</th>
          <td id="transaction_data">Loading...</td>
        </tr>
      </table>
    </div>
  </div>
  <script>
    window.onload = function(){
      //put your Ethereum HTTP API url here or test the example
      let apiUrl = "https://ropsten.infura.io/";
      
      //put your Ethereum transaction hash here or test the example
      let transactionHash = '0x8ae745faa259299245c54e478b4f1bdf4b025f7b29de102fd0331a3ab0405779';
      
      document.getElementById('transaction_hash').innerHTML = transactionHash;
      
      const bptEth = new BptEth(apiUrl);
      
      console.log('Getting transaction data...');
      
      let transactionPayload = bptEth.getTransactionPayload(transactionHash);
      
      console.log(transactionPayload);
      
      document.getElementById('transaction_data').innerHTML = escapeHtmlEntities(transactionPayload.payloadAscii);
    };
    
    function escapeHtmlEntities(rawStr){
      var encodedStr = rawStr.replace(/[\u00A0-\u9999<>\&]/gim, function(i) {
         return '&#'+i.charCodeAt(0)+';';
      });
      
      return encodedStr;
    }
  </script>
</body>
</html>